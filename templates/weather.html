{% extends "base.html" %}

{% block title %}Időjárás - Bük{% endblock %}

{% block content %}
<h2>Aktuális időjárás - Bük</h2>

<div id="weather-box" class="mt-4">
    <p><strong>Hőmérséklet:</strong> <span id="temp">Betöltés...</span> °C</p>
    <p><strong>Hőérzet:</strong> <span id="feels_like">Betöltés...</span> °C</p>
    <p><strong>Páratartalom:</strong> <span id="humidity">Betöltés...</span> %</p>
</div>

<hr>

<h3>Esett</h3>

<form method="post" class="mb-4">
    <div class="mb-3">
        <label for="date" class="form-label">Dátum:</label>
        <input type="date" class="form-control" id="date" name="date" required>
    </div>
    <div class="mb-3">
        <label for="amount" class="form-label">Csapadékmennyiség (mm):</label>
        <input type="number" class="form-control" id="amount" name="amount" step="0.1" required>
    </div>
    <button type="submit" class="btn btn-secondary">Mentés</button>
</form>

<p><strong>Éves összes csapadék:</strong> {{ total_rainfall }} mm (törlés: adott napra 0 mm)</p>

<script>
    async function loadWeather() {
        try {
            const response = await fetch("/api/openmeteo");
            const data = await response.json();

            document.getElementById("temp").textContent = data.temp ?? "n/a";
            document.getElementById("feels_like").textContent = data.feels_like ?? "n/a";
            document.getElementById("humidity").textContent = data.humidity ?? "n/a";
        } catch (error) {
            document.getElementById("weather-box").innerHTML = "<p class='text-danger'>Nem sikerült lekérni az időjárást.</p>";
        }
    }

    loadWeather();
</script>
{% endblock %}
