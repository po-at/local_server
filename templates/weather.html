{% extends "base.html" %}

{% block title %}Időjárás - Bük{% endblock %}

{% block content %}
<h2>Aktuális időjárás - Bük (Open-Meteo)</h2>

<div id="weather-box" class="mt-4">
    <p><strong>Hőmérséklet:</strong> {{ temp if temp is not none else "n/a" }} °C (saját mért érték: </strong> {{
        user_temp if user_temp is not none else "nincs megadva" }} °C)
    </p>
    <p><strong>Hőérzet:</strong> {{ feels_like if feels_like is not none else "n/a" }} °C</p>
    <p><strong>Páratartalom:</strong> {{ humidity if humidity is not none else "n/a" }} %</p>
</div>

{% if error %}
<div class="alert alert-danger mt-3">{{ error }}</div>
{% endif %}

<hr>

<h3>Adatok felvitele</h3>

<form method="post" class="mb-4">
    <div class="mb-3">
        <label for="user_temp" class="form-label">Saját mért hőmérséklet (°C):</label>
        <input type="number" class="form-control" id="user_temp" name="user_temp" step="0.1">
        <small class="form-text text-muted">Naponta egy hőmérsékletet tárol!</small>
    </div>

    <hr>

    <div class="mb-3">
        <label for="date" class="form-label">Ekkor esett:</label>
        <input type="date" class="form-control" id="date" name="date">
    </div>
    <div class="mb-3">
        <label for="amount" class="form-label">Csapadékmennyiség (mm):</label>
        <input type="number" class="form-control" id="amount" name="amount" step="0.1">
    </div>

    <button type="submit" class="btn btn-primary">Mentés</button>
</form>

<p><strong>Éves összes csapadék:</strong> {{ total_rainfall }} mm</p>

<hr> <hr>

{% if previous_diffs and previous_diffs|length > 0 %}
<h3>Korábbi hőmérséklet-különbségek</h3>
<table class="table table-striped">
    <thead>
        <tr>
            <th>Dátum</th>
            <th>Hőmérséklet (°C)</th>
            <th>Különbség (°C)</th>
        </tr>
    </thead>
    <tbody>
    {% for entry in previous_diffs %}
        <tr>
            <td>{{ entry.date }}</td>
            <td>{{ entry.content }}</td>
            <td>{{ entry.amount }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p>Nincs korábbi adat.</p>
{% endif %}

<h3>
  <a data-bs-toggle="collapse" href="#rainfallCollapse" role="button" aria-expanded="false" aria-controls="rainfallCollapse">
    + Korábbi adatok (éves, havi, napi bontásban)
  </a>
</h3>
<div class="collapse" id="rainfallCollapse">
  {% for year, months in rainfall_data.items() %}
    <div class="card my-2">
      <div class="card-header">
        <a data-bs-toggle="collapse" href="#year-{{ year }}" role="button">+ {{ year }}</a>
      </div>
      <div class="collapse" id="year-{{ year }}">
        <div class="card-body">
          {% for month, days in months.items() %}
            <div class="mb-2">
              <a data-bs-toggle="collapse" href="#month-{{ year }}-{{ month }}" role="button">
                + {{ month }}: {{ days | map(attribute=1) | sum | round(1) }} mm
              </a>
              <div class="collapse ps-3" id="month-{{ year }}-{{ month }}">
                <ul>
                  {% for date, amount in days %}
                    <li>{{ date }}: {{ amount }} mm</li>
                  {% endfor %}
                </ul>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
  {% endfor %}
</div>

{% endblock %}